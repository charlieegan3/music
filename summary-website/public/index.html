<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>charlieegan3 Music</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/fdaciuk-ajax/3.0.4/ajax.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script>
		<link rel="stylesheet" href="https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css"/>
		<link href="https://fonts.googleapis.com/css?family=Krub|Londrina+Solid" rel="stylesheet">
		<style>
			body {
				font-family: 'Krub', sans-serif;
			}
			.display {
				font-family: 'Londrina Solid', cursive;
			}
		</style>
		<script>
			function renderPlays(plays, tableID) {
				var playsWeekTable = document.getElementById(tableID);
				for (var i = 0; i < plays.length; i++) {
					var play = plays[i];
					var row = document.createElement("tr");

					var image = document.createElement("td");
					var img = document.createElement("img");
					var link = document.createElement("a");
					link.setAttribute("href", "https://open.spotify.com/track/" + play.Spotify);
					link.className = "no-underline dark-gray";
					img.setAttribute("src", play.Artwork);
					img.className = "w2 ba"
					link.appendChild(img);
					image.appendChild(link);
					row.appendChild(image);

					var track = document.createElement("td");
					var link = document.createElement("a");
					link.setAttribute("href", "https://open.spotify.com/track/" + play.Spotify);
					link.innerHTML = "<strong>" + play.Track + "</strong> <span class=\"mid-gray\">by</span> " + play.Artist;
					link.className = "no-underline dark-gray";
					track.appendChild(link);
					row.appendChild(track);

					var count = document.createElement("td");
					count.innerHTML = "<strong>" + play.Count.toString() + "</strong> plays";
					row.appendChild(count);

					playsWeekTable.appendChild(row);
				}
			}

			function renderArtists(artists, messageID, count) {
				var list = [];
				for (var i = 0; i < artists.length; i++) {
					list.push(artists[i].Artist)
					if (i >= (count - 1)) {
						break;
					}
				}
				document.getElementById(messageID).innerHTML = list.join(", ");
			}

			function renderPlaysByMonth(playsByMonth) {
				var months = [], counts = [];
				for (var i = 0; i < playsByMonth.length; i++) {
					months.push(playsByMonth[i].Pretty);
					counts.push(playsByMonth[i].Count);
				}

				var color = Chart.helpers.color;
				var barChartData = {
					labels: months,
					datasets: [{
						data: counts,
						label: "Plays",
						backgroundColor: color("lightgray").alpha(0.5).rgbString(),
						borderColor: "lightgray",
						borderWidth: 1,
					}]
				};

				var ctx = document.getElementById("PlaysByMonth").getContext("2d");
				window.myBar = new Chart(ctx, {
					type: "bar",
					data: barChartData,
					options: {
						responsive: true,
						legend: { display: false },
						title: { display: false },
						scales: {
							xAxes: [{
								gridLines: { display: false }
							}],
							yAxes: [{
								gridLines: { display: false },
								ticks: { beginAtZero: true }
							}]
						}
					}
				});
			}

			ajax().get("https://storage.googleapis.com/charlieegan3-music-summary/stats.json").then(function (response, xhr) {
				renderPlays(response.PlaysWeek, "PlaysWeek");
				renderPlays(response.PlaysMonth, "PlaysMonth");
				renderPlays(response.PlaysYear, "PlaysYear");

				renderArtists(response.ArtistsMonth, "ArtistsMonth", 5);
				renderArtists(response.ArtistsYear, "ArtistsYear", 5);

				renderPlaysByMonth(response.PlaysByMonth);
			})
		</script>
	</head>

	<body>
		<div class="mw7 center ph1 ph2-ns">
			<h1 class="mb2 f2-ns f4">charlieegan3 <span class="f2-ns f4 dark-blue display">music</span></h1>


			<h2 class="f4-ns f5 bt pt3 b--light-gray">top this week</h2>
			<table id="PlaysWeek" class="f6-ns f7 w-100"></table>

			<h2 class="f4-ns f5 bt pt3 b--light-gray">top this month</h2>
			<table id="PlaysMonth" class="f6-ns f7 w-100"></table>
			<p class="f7 f6-ns"><strong>Artists:</strong> <span id="ArtistsMonth"></span></p>

			<h2 class="f4-ns f5 bt pt3 b--light-gray">plays by month</h2>
			<canvas id="PlaysByMonth"></canvas>

			<h2 class="f4-ns f5 bt pt3 b--light-gray">top this year</h2>
			<table id="PlaysYear" class="f6-ns f7 w-100"></table>
			<p class="f7 f6-ns"><strong>Artists:</strong> <span id="ArtistsYear"></span></p>
		</div>
	</body>
</html>
